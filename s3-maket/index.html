<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>S3 File Browser (Files Only)</title>
</head>
<body>
  <h1>ðŸŽµ Files in Yandex S3</h1>
  <ul id="file-list"></ul>

  <script>
    const BUCKET_NAME = 'sh-blur-media'; // your bucket
    const BASE_URL = `https://storage.yandexcloud.net/${BUCKET_NAME}/`;
    const API_URL = `https://storage.yandexcloud.net/${BUCKET_NAME}/?list-type=2`;

    async function listAllFiles(marker = "", allKeys = []) {
      const url = marker ? `${API_URL}&start-after=${encodeURIComponent(marker)}` : API_URL;
      const response = await fetch(url);
      const xmlText = await response.text();

      const parser = new DOMParser();
      const xml = parser.parseFromString(xmlText, "application/xml");

      const contents = Array.from(xml.getElementsByTagName("Contents"));
      for (const node of contents) {
        const key = node.getElementsByTagName("Key")[0].textContent;

        // Ignore keys that look like "folders" (end with "/")
        if (!key.endsWith("/")) {
          allKeys.push(key);
        }
      }

      const isTruncated = xml.getElementsByTagName("IsTruncated")[0]?.textContent === "true";
      const lastKey = allKeys[allKeys.length - 1];

      if (isTruncated && lastKey) {
        return listAllFiles(lastKey, allKeys);
      } else {
        return allKeys;
      }
    }

    async function renderFileList() {
      const fileList = await listAllFiles();
      const ul = document.getElementById("file-list");
      fileList.forEach(key => {
        const li = document.createElement("li");
        const link = document.createElement("a");
        link.href = BASE_URL + encodeURIComponent(key);
        link.textContent = key;
        link.target = "_blank";
        li.appendChild(link);
        ul.appendChild(li);
      });
    }

    renderFileList();
  </script>
</body>
</html>
